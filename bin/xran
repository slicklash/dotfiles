#!/bin/sh

LAPTOP_PORT="eDP"
LAPTOP_MODE="1920x1200"
LAPTOP_PAN="3840+0"

MONITOR_PORT="DisplayPort-1"
MONITOR_MODE="3840x2160"
MONITOR_PAN="0+0"

SCREEN_SIZE="5760x2160"

DEVICES=$(xrandr | python -c "import sys;xs=sys.stdin;print([x.split()[0]+'='+xs.readline().split()[0] for x in xs if ' connected' in x])")

if echo "$DEVICES" | grep -q "eDP-1-1"; then
  LAPTOP_PORT="eDP-1-1"
  MONITOR_PORT="DP-1-2"
elif echo "$DEVICES" | grep -q "DisplayPort-0"; then
  MONITOR_PORT="DisplayPort-0"
  LAPTOP_MODE="1920x1080"
fi

FONT_NAME="JetBrains Mono NL Light"
FONT_SIZE_MONO=10
FONT_SIZE_TERMINAL=13
DPI=96
PANEL="panel-0"
PANEL_SIZE=24
PANEL_OUTPUT=$MONITOR_PORT

if echo "$DEVICES" | grep -q "$MONITOR_PORT=3840x2160"; then
  FONT_SIZE_MONO=12
  FONT_SIZE_TERMINAL=15
  DPI=122
  PANEL_SIZE=32
elif echo "$DEVICES" | grep -q "$MONITOR_PORT=2560x1440"; then
  MONITOR_MODE="2560x1440"
  SCREEN_SIZE="4480x1440"
  LAPTOP_PAN="2560+0"
else
  PANEL_OUTPUT=$LAPTOP_PORT
  SCREEN_SIZE=$LAPTOP_MODE
fi

if [ "$1" = "--laptop" ]; then
  PANEL_OUTPUT=$LAPTOP_PORT
  xrandr \
    --fb $LAPTOP_MODE \
    --output $LAPTOP_PORT --mode $LAPTOP_MODE --scale 1x1 --panning "$LAPTOP_MODE+0+0" --rate 120 --primary \
    --output $MONITOR_PORT --off
elif [ "$1" = "--monitor" ]; then
  xrandr \
    --fb $MONITOR_MODE \
    --output $MONITOR_PORT --mode $MONITOR_MODE --scale 1x1 --panning "$MONITOR_MODE+0+0" --rate 60 \
    --output $LAPTOP_PORT --off
else
  xrandr \
    --fb $SCREEN_SIZE \
    --output $LAPTOP_PORT --mode $LAPTOP_MODE --scale 1x1 --panning "$LAPTOP_MODE+$LAPTOP_PAN" --rate 120 \
    --output $MONITOR_PORT --mode $MONITOR_MODE --scale 1x1 --panning "$MONITOR_MODE+$MONITOR_PAN" --rate 60 \
    --left-of $LAPTOP_PORT --primary
fi

xfconf-query -c xfce4-panel -p "/panels/$PANEL/size" -s "$PANEL_SIZE" > /dev/null 2>&1
if [ $? -ne 0 ]; then
  PANEL="panel-1"
  xfconf-query -c xfce4-panel -p "/panels/$PANEL/size" -s "$PANEL_SIZE"
fi
xfconf-query -c xfce4-panel -p "/panels/$PANEL/output-name" -s "$PANEL_OUTPUT"
xfconf-query -c xfce4-panel -p "/panels/$PANEL/size" -s "$PANEL_SIZE"
xfconf-query -c xsettings -p /Xft/DPI -s "$DPI"
xfconf-query -c xsettings -p /Gtk/MonospaceFontName -s "$FONT_NAME $FONT_SIZE_MONO"
sed -i "s#FontName=.*#FontName=$FONT_NAME $FONT_SIZE_TERMINAL#" ~/.config/xfce4/terminal/terminalrc
